<!DOCTYPE html>
<html>

<head>
    <title>Leaflet Quick Start Guide Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="leaflet-0.7.5.css" /> -->
    <link rel="stylesheet" href="leaflet-0.7.5.css" />
</head>

<body>
    <div id="map" style="width: 600px; height: 400px"></div>
    <!-- // <script src="leaflet.js"></script> -->
    <script src="leaflet-0.7.5.js"></script>
    <script>
    var map = L.map('map').setView([51.505, -0.09], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        id: 'mapbox.streets'
    }).addTo(map);


    L.marker([51.5, -0.09]).addTo(map)
        .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

    L.circle([51.508, -0.11], 500, {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.5
    }).addTo(map).bindPopup("I am a circle.");

    L.polygon([
        [51.509, -0.08],
        [51.503, -0.06],
        [51.51, -0.047]
    ]).addTo(map).bindPopup("I am a polygon.");


    var popup = L.popup();

    var MyCustomLayer = L.Class.extend({

        initialize: function(latlng) {
            // save position of the layer or any options from the constructor
            this._latlng = latlng;
            console.log(latlng);
        },

        onAdd: function(map) {
            this._map = map;

            // create a DOM element and put it into one of the map panes


            this._el = L.DomUtil.create('div', 'my-custom-layer leaflet-zoom-hide');


            console.log("here");

            map.getPanes().overlayPane.appendChild(this._el);

            // add a viewreset event listener for updating layer's position, do the latter
            map.on('viewreset', this._reset, this);
            this._reset();

            var a = document.getElementsByClassName("leaflet-zoom-hide");
            div = a[a.length - 1];
            div.style.width = "100px";
            div.style.height = "100px";
            div.style.background = "red";
            div.style.color = "white";
            div.innerHTML = "Hello";
            console.log(div);
        },

        onRemove: function(map) {
            // remove layer's DOM elements and listeners
            map.getPanes().overlayPane.removeChild(this._el);
            map.off('viewreset', this._reset, this);
        },

        _reset: function() {
            // update layer's position
            var pos = this._map.latLngToLayerPoint(this._latlng);

            console.log("pos", pos)
            L.DomUtil.setPosition(this._el, pos);
        }
    });


    var mylayper = new MyCustomLayer();

    function onMapClick(e) {

        console.log("onMapClick", e.latlng);

        if(mylayper)
            map.removeLayer(mylayper);

        mylayper = new MyCustomLayer(e.latlng);        
        map.addLayer(mylayper);
    }

    map.on('click', onMapClick);
    </script>
</body>

</html>
